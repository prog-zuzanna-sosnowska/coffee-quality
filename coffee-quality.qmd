---
title: "Analiza jakości kawy"
authors: "Zuzanna Sosnowska, Jagoda Płócienniczak" 
---

## 1. Wstęp

Celem naszego sprawozdania jest analiza jakości kawy na podstawie cech związanych z jej charakterem sensorycznym, miejscem uprawy oraz metodą przetwarzania. Oceny kaw opierają się na różnych aspektach, takich jak aromat, smak, posmak czy kwasowość, które wspólnie tworzą końcową ocenę jakości wyrażoną w punktach (`Total.Cup.Points`).

Analiza tych danych umożliwi lepsze zrozumienie, które cechy w największym stopniu wpływają na końcową ocenę jakości kawy. Ponadto przeanalizujemy, w jaki sposób takie czynniki jak wysokość upraw (`Altitude`), kraj pochodzenia (`Country.of.Origin`) oraz metoda przetwarzania (`Processing.Method`) wpływają na różnice w wynikach oceny sensorycznej.

## 2. Pochodzenie danych

Dane pochodzą z bazy Coffee Quality Database (styczeń 2018), prowadzonej przez Coffee Quality Institute (CQI), organizację non-profit zajmującą się oceną i poprawą jakości kawy na świecie. Oryginalne dane zostały pozyskane ze strony internetowej CQI ([database.coffeeinstitute.org](https://database.coffeeinstitute.org)) za pomocą narzędzi web scrapingowych, takich jak Selenium i Beautiful Soup. Zbiór danych, który analizujemy w dalszej części sprawozdania, pochodzi z platformy Kaggle i stanowi wersję przetworzoną – zawiera zarówno surowe dane (takie jak pobrano z CQI), jak i dane oczyszczone, w których ujednolicono formaty i jednostki miar dla wybranych zmiennych.

**2.1. Licencja danych**\
Dane na Kaggle zostały udostępnione jako część projektu opublikowanego przez użytkownika GitHub z zastosowaniem licencji MIT. Licencja ta pozwala na swobodne wykorzystanie danych, również w celach edukacyjnych, o ile zachowana zostanie informacja o oryginalnym źródle. Warto jednak zaznaczyć, że pierwotne dane z CQI nie mają określonej licencji, co sugeruje konieczność ich wykorzystania z zachowaniem ostrożności, szczególnie w kontekstach komercyjnych.

## 3. Opis zmiennych

Dane, które analizujemy, obejmują szeroki zakres informacji dotyczących jakości kawy, w tym jej cech sensorycznych, metadanych związanych z ziarnami oraz szczegółów dotyczących farm, z których pochodzi. Zebrane informacje zostały podzielone na kilka kategorii. Poniżej przedstawiamy szczegółowy opis dostępnych zmiennych:

**3.1. Miary jakości kawy (Quality Measures)**

-   **Aroma (aromat)** – ocena zapachu kawy, w skali od 0 do 10 punktów. Wysoka ocena wskazuje na intensywny, przyjemny aromat.

-   **Flavor (smak)** – ocena smaku kawy, w skali od 0 do 10 punktów. Uwzględnia harmonię i intensywność smaków.

-   **Aftertaste (posmak)** – ocena wrażeń smakowych po spożyciu kawy, w skali od 0 do 10 punktów.

-   **Acidity (kwasowość)** – ocena poziomu i charakteru kwasowości kawy, w skali od 0 do 10 punktów.

-   **Body (konsystencja)** – ocena wrażeń związanych z ciężkością i teksturą kawy, w skali od 0 do 10 punktów.

-   **Balance (balans)** – ocena harmonii pomiędzy różnymi cechami sensorycznymi, w skali od 0 do 10 punktów.

-   **Uniformity (jednorodność)** – wskaźnik spójności smaku pomiędzy filiżankami, w skali od 0 do 10 punktów.

-   **Cup Cleanliness (czystość smaku)** – ocena obecności negatywnych nut smakowych, w skali od 0 do 10 punktów.

-   **Sweetness (słodycz)** – ocena słodkich nut w kawie, w skali od 0 do 10 punktów.

-   **Moisture (wilgotność)** – zawartość wody w ziarnach kawy, wyrażona w procentach.

-   **Defects (wady)** – liczba defektów w próbce kawy, co może wpływać negatywnie na jej jakość.

**3.2. Metadane o ziarnach kawy (Bean Metadata)**

-   **Processing.Method (metoda przetwarzania)** – sposób przetwarzania ziaren kawy (np. „natural”, „washed”).

-   **Color (kolor)** – kolor ziaren kawy (np. „green”, „yellow”).

-   **Species (gatunek)** – gatunek kawy: arabica lub robusta.

**3.3. Metadane o farmach (Farm Metadata)**

-   **Owner (właściciel)** – nazwa właściciela farmy.

-   **Country.of.Origin (kraj pochodzenia)** – kraj, z którego pochodzi kawa.

-   **Farm.Name (nazwa farmy)** – nazwa farmy, na której uprawiana była kawa.

-   **Lot.Number (numer partii)** – numer partii kawy.

-   **Mill (młyn)** – nazwa młyna, w którym przetwarzano kawę.

-   **Company (firma)** – firma zajmująca się dystrybucją kawy.

-   **Altitude (wysokość upraw)** – wysokość, na której uprawiana jest kawa, wyrażona w metrach nad poziomem morza.

-   **Region (region)** – region, w którym znajduje się farma.

Ze względu na obszerność danych, do szczegółowej analizy wybierzemy te zmienne, które naszym zdaniem mają największy wpływ na jakość kawy (`Flavor`,`Aroma`, `Processing.Method`) oraz te, które wzbudziły naszą ciekawość (`Country.Of.Origin`, `altitude_mean_meters`). Dzięki temu będziemy mogli skoncentrować się na kluczowych aspektach, które umożliwią wyciągnięcie trafnych i precyzyjnych wniosków.

Postaramy się również odpowiedzieć na następujące pytania badawcze:

-   Jakie cechy sensoryczne (np. aromat, smak) mają największy wpływ na ogólną ocenę jakości kawy (`Total.Cup.Points`)?

-   Czy wysokość, na której uprawiana jest kawa (`Altitude`), ma istotny wpływ na jej jakość ocenianą sensorycznie?

-   Jak oceny sensoryczne kaw różnią się w zależności od kraju pochodzenia (`Country.of.Origin`) i metody przetwarzania (`Processing.Method`)?

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Wczytane pakiety
library(dplyr)
library(ggplot2)
library(reshape2)
library(tidyverse)
library(patchwork)
library(knitr)
library(countrycode)
library(GGally)
library(psych)
library(moments)
library(statpsych)
```

```{r, echo=FALSE}
# Oryginalne dane
data <- read.csv("arabica_data_cleaned.csv")
# Nie bierzemy pod uwagę danych z ostatniego wiersza, ze względu na to, że zawiera błędy - ogólna ocena kawy nie może wynosić zero.
data <- head(data, -1)
# Do pustych rubryk przypisujemy NA
data[data == ""] <- NA
```

```{r, echo=FALSE}
#Przesiewanie danych 
data_clean <- data[c("Country.of.Origin", "Processing.Method", "Aroma", "Flavor", "Acidity", "Aftertaste","Moisture", "altitude_mean_meters", "Total.Cup.Points")] |>
  mutate(Processing.Method = factor(Processing.Method),)

# Jeśli wysokość nad poziomem morza przekracza 8000 metrów to uprawa kawy jest niemożlwa i w danych jest błąd.
data_clean$altitude_mean_meters[data_clean$altitude_mean_meters > 8000] <- NA
data_clean$Country.of.Origin[data_clean$Country.of.Origin == "Tanzania, United Republic Of"] <- "Tanzania"
data_clean$Country.of.Origin[data_clean$Country.of.Origin == "Cote d?Ivoire"] <- "Cote d'ivoire"
view(data_clean)
```

```{r, echo=FALSE, results='hide'}
#Liczba braku danych
sum(is.na(data_clean$Processing.Method))
sum(is.na(data_clean$Country.of.Origin))
sum(is.na(data_clean$altitude_mean_meters))
sum(is.na(data_clean$Flavor))
sum(is.na(data_clean$Aroma))
sum(is.na(data_clean$Acidity))
sum(is.na(data_clean$Aftertaste))
sum(is.na(data_clean$Total.Cup.Points))
```

## 4. Analiza danych

**4.1.Statystyki opisowe**

Zanim przejdziemy do głębszej analizy danych, zacznijmy od zaprezentowania podstawowych statystyk opisowych, które stanowią fundament każdej analizy. Statystyki te pozwolą na zrozumienie ogólnych właściwości badanych zmiennych i ułatwią interpretację końcowych wyników.

**a) zmienne ciągłe**

Poniższa tabela przedstawia podstawowe statystyki opisowe dla zmiennych ciągłych, w tym: średnią, medianę, odchylenie standardowe, skośność, kurtozę oraz rozstęp z próby dla badanych parametrów.

```{r, echo = FALSE, results='hide'}
#Statystyki opisowe

#Flavor
mean_flavor <- mean(data_clean$Flavor, na.rm = TRUE)
median_flavor <- median(data_clean$Flavor, na.rm = TRUE)
sd_flavor <- sd(data_clean$Flavor, na.rm = TRUE)
min_flavor <- min(data_clean$Flavor, na.rm = TRUE)  
max_flavor <- max(data_clean$Flavor, na.rm = TRUE)
skew_flavor <- skewness(data_clean$Flavor, na.rm = TRUE)
kurt_flavor <- kurtosis(data_clean$Flavor, na.rm = TRUE)
rozrzut_flavor <- max_flavor - min_flavor

#Aroma
mean_aroma <- mean(data_clean$Aroma, na.rm = TRUE)
median_aroma <- median(data_clean$Aroma, na.rm = TRUE)
sd_aroma <- sd(data_clean$Aroma, na.rm = TRUE)
min_aroma <- min(data_clean$Aroma, na.rm = TRUE)  
max_aroma <- max(data_clean$Aroma, na.rm = TRUE)
skew_aroma <- skewness(data_clean$Aroma, na.rm = TRUE)
kurt_aroma <- kurtosis(data_clean$Aroma, na.rm = TRUE)
rozrzut_aroma <- max_aroma - min_aroma

#Acidity
mean_acidity <- mean(data_clean$Acidity, na.rm = TRUE)
median_acidity <- median(data_clean$Acidity, na.rm = TRUE)
sd_acidity <- sd(data_clean$Acidity, na.rm = TRUE)
min_acidity <- min(data_clean$Acidity, na.rm = TRUE)  
max_acidity <- max(data_clean$Acidity, na.rm = TRUE)
skew_acidity <- skewness(data_clean$Acidity, na.rm = TRUE)
kurt_acidity <- kurtosis(data_clean$Acidity, na.rm = TRUE)
rozrzut_acidity <- max_acidity - min_acidity

#Aftertaste
mean_aftertaste <- mean(data_clean$Aftertaste, na.rm = TRUE)
median_aftertaste <- median(data_clean$Aftertaste, na.rm = TRUE)
sd_aftertaste <- sd(data_clean$Aftertaste, na.rm = TRUE)
min_aftertaste <- min(data_clean$Aftertaste, na.rm = TRUE)  
max_aftertaste <- max(data_clean$Aftertaste, na.rm = TRUE)
skew_aftertaste <- skewness(data_clean$Aftertaste, na.rm = TRUE)
kurt_aftertaste <- kurtosis(data_clean$Aftertaste, na.rm = TRUE)
rozrzut_aftertaste <- max_aftertaste - min_aftertaste


#Altitude
mean_altitude <- mean(data_clean$altitude_mean_meters, na.rm = TRUE)
median_altitude <- median(data_clean$altitude_mean_meters, na.rm = TRUE)
sd_altitude <- sd(data_clean$altitude_mean_meters, na.rm = TRUE)
min_altitude <- min(data_clean$altitude_mean_meters, na.rm = TRUE)  
max_altitude <- max(data_clean$altitude_mean_meters, na.rm = TRUE)
skew_altitude <- skewness(data_clean$altitude_mean_meters, na.rm = TRUE)
kurt_altitude <- kurtosis(data_clean$altitude_mean_meters, na.rm = TRUE)
rozrzut_altitude <- max_altitude - min_altitude

#Total.Cup.Points
mean_points <- mean(data_clean$Total.Cup.Points, na.rm = TRUE)
median_points <- median(data_clean$Total.Cup.Points, na.rm = TRUE)
sd_points <- sd(data_clean$Total.Cup.Points, na.rm = TRUE)
min_points <- min(data_clean$Total.Cup.Points, na.rm = TRUE)  
max_points <- max(data$Total.Cup.Points, na.rm = TRUE)
skew_points <- skewness(data_clean$Total.Cup.Points, na.rm = TRUE)
kurt_points <- kurtosis(data_clean$Total.Cup.Points, na.rm = TRUE)
rozrzut_points <- max_points - min_points

#Processing.Method
count_method <- table(data_clean$Processing.Method)

#Country.of.Origin
count_country <- table(data_clean$Country.of.Origin)
```

```{r, echo = FALSE, message=FALSE}
# Statystyki - zmienne ciągłe
stats_description_a <- data.frame(
  Zmienna = c("Flavor", "Aroma", "Acidity", "Aftertaste", "Total.Cup.Points", "Altitude [m]"),
  Średnia = round(c(mean_flavor, mean_aroma, mean_acidity, mean_aftertaste, mean_points, mean_altitude), 3),
  Mediana = round(c(median_flavor, median_aroma, median_acidity, median_aftertaste, median_points, median_altitude), 3),
  Odchylenie.standardowe = round(c(sd_flavor, sd_aroma, sd_acidity, sd_aftertaste,  sd_points, sd_altitude), 3),
  Skośność = round(c(skew_flavor, skew_aroma, skew_acidity, skew_aftertaste, skew_points, skew_altitude), 3),
  Kurtoza = round(c(kurt_flavor, kurt_aroma, kurt_acidity, kurt_aftertaste, kurt_points, kurt_altitude), 3),
  Rozrzut = round(c(rozrzut_flavor, rozrzut_aroma, rozrzut_acidity, rozrzut_aftertaste, rozrzut_points, rozrzut_altitude), 3)
)

kable(stats_description_a, format = "markdown", col.names = c("Zmienna", "Średnia", "Mediana", "Odch. Std.", "Skośność", "Kurtoza", "Rozstęp próby"))
```

<br>

Zauważmy kilka faktów:

-   Dla zmiennych **Flavor**, **Aroma**, **Acidity** i **Aftertaste** różnice między medianą a średnią są niewielkie (odpowiednio: 0.056, 0.01, 0.039, 0.017), a w każdym przypadku średnia jest nieco niższa od mediany. Taki układ wskazuje na niemal symetryczny rozkład lub delikatną skośność lewostronną. Dodatkowo, wartość estymowanej skośności jest bliska zeru, co również potwierdza, że rozkłady te są zbliżone do symetrycznych i ewentualne odchylenia są minimalne.

    Dla zmiennej **Total.Cup.Points** różnica między medianą a średnią również jest niewielka, ale wartość estymatora skośności poniżej -1 wskazuje na bardziej wyraźną lewostronną skośność. Oznacza to, że w tym przypadku rozkład jest lekko przesunięty, z dłuższym ogonem po stronie niższych wartości.

    W przypadku zmiennej **Altitude** (wysokość uprawy) sytuacja jest odmienna: mediana jest mniejsza od średniej, co wskazuje na słabą prawostronną skośność. Potwierdza to wartość współczynnika skośności - wynosi ona ponad 0.5 co potwierdza nasze przypuszczenia.

-   Dla zmiennych **Flavor**, **Aroma**, **Acidity** i **Aftertaste** odchylenie standardowe wynosi około **0.3**, co oznacza, że większość obserwacji jest skoncentrowana w wąskim zakresie wartości od około **7.2 do 7.8**. W porównaniu z pełnym zakresem możliwych wartości (0–10) wskazuje to na bardzo małą zmienność tych cech. Również analiza rozstępu próby (różnicy między wartością minimalną a maksymalną) dla tych parametrów pokazuje stosunkowo niewielkie rozproszenie: wynosi ono odpowiednio **2.75**, **3.67**, **3.5** i **2.5**.

    Dla zmiennej **Total.Cup.Points** (ogólnej oceny kawy) odchylenie standardowe wynosi **2.686**, co w odniesieniu do pełnego zakresu **0–100** jest stosunkowo niską wartością. Wskazuje to, że ogólna ocena kawy również charakteryzuje się umiarkowaną zmiennością.

    Natomiast dla cechy **Altitude** (wysokości uprawy) zarówno odchylenie standardowe, jak i rozstęp z próby przyjmują znacznie większe wartości w relacji do średniej wynoszącej . Świadczy to o dużym rozproszeniu danych w tym przypadku 4286.00, co oznacza, że wysokości upraw kawy są znacznie bardziej zróżnicowane niż pozostałe analizowane cechy.

-   Kurtoza dla wszystkich analizowanych cech jest większa niż 3, co oznacza, że rozkłady tych zmiennych są **leptokurtyczne**. Takie rozkłady charakteryzują się "grubszymi" ogonami, co wskazuje na wyższą intensywność wartości skrajnych w porównaniu do rozkładu normalnego. W praktyce oznacza to, że w danych występuje większa liczba ekstremalnych obserwacji niż w przypadku klasycznego rozkładu normalnego.

**b) zmienne kategoryczne**

Dla zmiennych kategorycznych przedstawiono na poniższych wykresach rozkład częstości występowania poszczególnych kategorii w badanych danych.

-   **Processing.Method**

```{r, echo = FALSE}
ggplot(data=subset(data_clean, !is.na(Processing.Method)), aes(x = fct_infreq(Processing.Method))) +
  geom_bar(fill = "lightblue") +
  labs(title = "Częstość występowania metod przetwarzania ziaren kawy", x = "Metoda przetwarzania", y = "Liczba wystąpień") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), plot.title = element_text(hjust = 0.5))
```

Najczęściej stosowaną metodą przetwarzania ziaren kawy jest "washed/wet", a zaraz za nią plasuje się metoda "natural/dry". Wysoka popularność tych metod rodzi pytanie, czy są one związane z wyższą jakością kawy. Choć na podstawie samej częstości ich występowania nie możemy tego jednoznacznie stwierdzić, stanowi to punkt wyjścia do dalszej analizy. Hipoteza ta zostanie szczegółowo zbadana w kolejnych częściach raportu (*rozdział 4.3.*).

-   **Country.of.Origin**

```{r, echo = FALSE}
ggplot(data=subset(data_clean, !is.na(Country.of.Origin)), aes(x = fct_infreq(Country.of.Origin))) +
  geom_bar(fill = "lightblue") +
  labs(title = "Częstość występowania krajów pochodzenia ziaren kawy", x = "Kraj pochodzenia", y = "Liczba wystąpień") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), plot.title = element_text(hjust = 0.5))
```

Powyższy wykres pokazuje dominację niektórych krajów w zestawieniu z innymi. Zauważmy, że najwięcej próbek pochodzi z Meksyku, Kolumbii i Gwatemali.

-   **Kontynent**

```{r, echo=FALSE}
# Zmiana nazwy kraju pochodzenia kawy w celu 
data_clean$Country.of.Origin <- ifelse(
  data_clean$Country.of.Origin == "United States (Puerto Rico)",
  "Puerto Rico",
  data_clean$Country.of.Origin
)

# Dodanie niestandardowego przypisania dla Puerto Rico
custom_matches <- c("Puerto Rico" = "Americas")

data_clean$Continent <- countrycode(
  sourcevar = data_clean$Country.of.Origin,
  origin = "country.name",
  destination = "continent",
  custom_match = custom_matches
)

# Analiza kontynentów
continent_data <- data_clean %>%
  filter(!is.na(Continent) & !is.na(Total.Cup.Points)) %>%
  group_by(Continent) %>%
  summarise(
    Średnia = mean(Total.Cup.Points, na.rm = TRUE),
    Liczba_Obserwacji = n()
  ) %>%
  filter(Liczba_Obserwacji >= 30) %>%
  inner_join(data_clean, by = "Continent")


ggplot(continent_data, aes(x = Continent, y = Total.Cup.Points, fill = Continent)) +
  geom_boxplot(width=0.35,  staplewidth=0.25,coef=3) +
  labs(title = "Boxplot ocen ogólnych według kontynentów", x = "Kontynent", y = "Ocena ogólna", caption="Wartości nietypowe zdefiniowano siatką Tukeya ze stałą 3") +
  theme_minimal()

```

Na podstawie powyższego wykresu pudełkowego można zauważyć, że **mediana oceny ogólnej kawy jest najwyższa w przypadku Afryki**. Może to sugerować, że kraje afrykańskie produkują kawy o wyższej jakości. Dodatkowo, górny wąs wykresu dla Afryki przekracza wartość 90 i jest wyraźnie dłuższy niż dolny wąs. Świadczy to o dużym zróżnicowaniu w ocenach, z przewagą wyższych wartości, co oznacza, że kawa z Afryki częściej osiąga wyjątkowo wysokie oceny.

Dla Ameryki i Azji mediana ocen jest na zbliżonym poziomie. W przypadku Ameryki wykres pokazuje dłuższe wąsy, co wskazuje na większe rozproszenie danych – kawa pochodząca z tego regionu może być zarówno bardzo dobrej jakości, jak i przeciętnej. Natomiast w Azji wąsy są krótsze niż w Ameryce, co sugeruje mniejszą zmienność w ocenach kawy. Azjatycka kawa charakteryzuje się nieco niższą medianą, ale bardziej jednorodnymi ocenami w porównaniu do kawy z Ameryki.

**4.2. Analiza - zmienne ciągłe**

W tej części postaramy się zbadać jak cechy takie jak (`Flavor`), (`Aroma`), (`Acidity`), (`Aftertaste`), (`Moisture`) czy (`Altitude`) wpływają na ogólny smak kawy.

**4.3.1. Wpływ zmiennych `Flavor`, `Aroma`, `Acidity`, `Aftertaste`**

```{r, echo=FALSE}
aftertaste_cor <- ggplot(data_clean, aes(x=Total.Cup.Points, y=Aftertaste)) + 
    geom_point(col = "#00FF00") + 
    geom_smooth(span = 0.2, col = "black") +
    labs(x = "Ocena kawy", y = "Ocena posmaku")
  
flavor_cor <- ggplot(data_clean, aes(x=Total.Cup.Points, y=Flavor)) + 
    geom_point(col = "#FC4E07") + 
    geom_smooth(span = 0.2, col = "black") +
  labs(x = "Ocena kawy", y = "Ocena smaku")

acidity_cor <- ggplot(data_clean, aes(x=Total.Cup.Points, y=Acidity)) + 
    geom_point(col = "#E7B800") + 
    geom_smooth(span = 0.2, col = "black") +
  labs(x = "Ocena kawy", y = "Ocena kwasowości")

aroma_cor <- ggplot(data_clean, aes(x=Total.Cup.Points, y=Aroma)) + 
    geom_point(col = "#00AFBB") + 
    geom_smooth(span = 0.2, col = "black") + 
  labs(x = "Ocena kawy", y = "Ocena aromatu")

  

(aftertaste_cor | flavor_cor) / (acidity_cor | aroma_cor) + plot_annotation(
  title = "Zależność między ogólną oceną kawy a poszczególnymi cechami")
```

Na powyższych wykresach przedstawiona została zależność oceny kawy od wybranych cech. Jak możemy zaobserwować punkty układają się wzdłuż krzywej regresji, dlatego możemy się spodziewać, że korelacja jest niezerowa.

```{r, echo=FALSE}
moisture_cor <- ggplot(data_clean[!is.na(data_clean$Moisture), ], aes(x=Total.Cup.Points, y=Moisture)) + 
    geom_point(col = "#00FF00") + 
    labs(x = "Ocena kawy", y = "Wilgotność ziaren kawy")
  
altitude_cor <- ggplot(data_clean[!is.na(data_clean$altitude_mean_meters), ], aes(x=Total.Cup.Points, y=altitude_mean_meters)) + 
    geom_point(col = "#FC4E07") + 
  coord_cartesian(ylim = c(0, 3000))
  labs(x = "Ocena kawy", y = "Wysokość uprawy")

moisture_cor + altitude_cor

```

```{r, echo=FALSE}
plot_flavour <- ggplot(data_clean, aes(x = Flavor)) +
  # geom_bar(fill = "lightblue") +
  geom_density(fill = "lightblue") + 
  labs(title = "Rozkład Flavour", x = "Flavor", y = "Liczba obserwacji") +
    xlim(5, 10) +
  theme_minimal(base_size = 8)

plot_aroma <- ggplot(data_clean, aes(x = Aroma)) +
  # geom_bar(fill = "lightgreen") +
  geom_density(fill = "lightgreen") + 
  labs(title = "Rozkład Aroma", x = "Aroma", y = "Liczba obserwacji") +
  xlim(5, 10) +
  theme_minimal(base_size = 8)

plot_acidity <- ggplot(data_clean, aes(x = Acidity)) +
  # geom_bar(fill = "lightpink") +
  geom_density(fill = "lightpink") + 
  labs(title = "Rozkład Acidity", x = "Acidity", y = "Liczba obserwacji") +
  xlim(5, 10) +
  theme_minimal(base_size = 8)

plot_aftertaste <- ggplot(data_clean, aes(x = Aftertaste)) +
  # geom_bar(fill = "lightgoldenrod") +
    geom_density(fill = "lightgoldenrod") + 
  labs(title = "Rozkład Aftertaste", x = "Aftertaste", y = "Liczba obserwacji") +
  xlim(5, 10) +
  theme_minimal(base_size = 8)

(plot_flavour + plot_aroma) / (plot_acidity + plot_aftertaste)
```

Powyższe wykresy estymują gęstość rozkładów dla poszczególnych zmiennych ciągłych. Jak możemy zauważyć,

```{r, echo = FALSE}
cor_data <- data_clean[c("Aroma", "Acidity", "Flavor", "Aftertaste", "Moisture", "altitude_mean_meters", "Total.Cup.Points")]

cor_matrix <- cor(cor_data, use = "complete.obs", method = "spearman")

cor_melt <- melt(cor_matrix)
# Tworzenie heatmapy z ggplot2
ggplot(cor_melt, aes(Var1, Var2, fill = value)) +
  geom_tile(color = "white") +
  geom_text(aes(label = round(value, 2)), color = "black", size = 4) +
  scale_fill_gradientn(colors = c("lightblue","lightyellow", "red"), 
                      values = scales::rescale(c(-0.21, 0.75, 1)), 
                       limits = c(-0.21, 1), 
                       name = "Korelacja") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  labs(title = "Heatmapa korelacji", x = "", y = "")
```

Powyższy wykres przedstawia heatmapę korelacji między różnymi cechami kawy: aromatem (Aroma), kwasowością (Acidity), smakiem (Flavour), posmakiem (Aftertaste), wilgotnością ziaren (Moisture), wysokością upraw (altitude_mean_meters) oraz ogólną oceną kawy (Total.Cup.Points). Kolory na heatmapie odzwierciedlają siłę i kierunek korelacji, przechodząc od niebieskiego (korelacje ujemne), przez bladożółty (brak korelacji), do czerwonego (silne korelacje dodatnie).

Zauważalna jest bardzo słaba korelacja między zmiennymi Moisture i Altitude – wartość bezwzględna tej korelacji jest mniejsza niż 0.2. Oznacza to, że te parametry mają niewielki związek z innymi zmiennymi na wykresie, co sugeruje, że **przy wyborze kawy niekoniecznie powinniśmy się kierować wilgotnością ziaren czy wysokością upraw**.

Najsilniejsze korelacje z ogólną oceną kawy (Total.Cup.Points) występują dla parametrów Flavor i Aftertaste – ich wartości przekraczają 0.8, osiągając niemal 0.9. Na heatmapie są one oznaczone kolorem pomarańczowym. Sugeruje to, że smak i posmak kawy są kluczowe przy ocenie jej jakości i warto zwracać na nie szczególną uwagę.

Inne istotne korelacje dotyczą aromatu i kwasowości – ich związki z oceną ogólną wynoszą odpowiednio 0.76 i 0.79. To wskazuje na znaczenie tych cech w postrzeganiu jakości kawy. Łącznie wyniki sugerują, że cechy takie jak smak, posmak, aromat i kwasowość mają największy wpływ na ogólną ocenę kawy, co warto uwzględnić przy wyborze lepszego produktu.

**4.3. Analiza - zmienne kategoryczne**

W tej części skupimy się na analizie jak zmienne `Processing.Method` i `Country.of.Origin` wpływają na oceny sensoryczne, a w ostateczności na końcową ewaluację smaku kawy.

**4.3.1. Wpływ zmiennej `Processing.Method`**

W *rozdziale 4.1. b)* zauważyliśmy, że metoda "Washed/Wet" przeważa liczebnie wśród badanych technik przetwarzania ziaren kawy. Teraz, przechodząc do analizy, przyjrzymy się, jak różne metody wpływają na sensoryczne oceny kawy, takie jak "Flavor" (*wykres a*) oraz "Aroma" (*wykres b*), a także na ogólną jakość kawy, wyrażoną poprzez "Total.Cup.Points" (*wykres c*). W tej części skupimy się na szczegółowej interpretacji tych wyników, uwzględniając również liczebność próbek, aby formułowane wnioski były jak najbardziej trafne i rzetelne.

**a)**

```{r, echo = FALSE}
ggplot(data=subset(data_clean, !is.na(Processing.Method)), aes(x = Processing.Method, y = Flavor)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5)) +
  labs(x = "Metoda przetwarzania", title = "Flavor w zależności od metody przetwarzania") +
  geom_boxplot()
```

**b)**

```{r, echo = FALSE}
ggplot(data=subset(data_clean, !is.na(Processing.Method)), aes(x = Processing.Method, y = Aroma)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5)) +
  labs(x = "Metoda przetwarzania", title = "Aroma w zależności od metody przetwarzania") +
  geom_boxplot()

```

**c)**

```{r, echo = FALSE}
ggplot(data=subset(data_clean, !is.na(Processing.Method)), aes(x = Processing.Method, y = Total.Cup.Points)) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5)) +
  labs(title="Total.Cup.Points w zależności od metody przetwarzania", x = "Metoda przetwarzania") +
  geom_boxplot()
```

**4.3.2. Wpływ zmiennej `Country.of.Origin`**

Celem tej analizy jest określenie, który kraj produkuje najlepszą kawę. Ze względu na dużą liczbę krajów w naszym zbiorze danych, na początek wykluczymy te, które mają mniej niż 30 obserwacji, ponieważ ich obecność mogłaby prowadzić do mniej wiarygodnych wniosków. Dodatkowo, skoncentrujemy się na krajach, których średnia punktacja "Total.Cup.Points" wynosi co najmniej 82 punkty, ponieważ międzynarodowe standardy uznają kawy oceniane na minimum 80 punktów za produkty najwyższej jakości.

```{r, echo=FALSE}
filtered_data <- data_clean %>%
  filter(!is.na(Country.of.Origin) & !is.na(Total.Cup.Points)) %>%
  group_by(Country.of.Origin) %>%
  summarise(Średnia = mean(Total.Cup.Points, na.rm = TRUE),
            Liczba_Obserwacji = n()) %>%
  filter(Średnia >= 82 & Liczba_Obserwacji >= 30) %>%
  inner_join(data_clean, by = "Country.of.Origin")

ggplot(data = filtered_data, aes(x = Country.of.Origin, y = Total.Cup.Points)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        plot.title = element_text(hjust = 0.5)) +
  labs(x = "Kraj pochodzenia", y = "Total Cup Points")

```
